<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="google-site-verification" content="9sGhMIXAruToaQRmDSE6ASbB-0hoIrcRN1JVj8uKwuQ">
<title>Search — AgentBase</title>
<style>
body{background:#0c0e12;color:#d4d8e0;font-family:'IBM Plex Mono',monospace;font-size:13px;padding:32px;line-height:1.8}
a{color:#f0a500;text-decoration:none}
</style>
</head>
<body>
<div id="output">Loading...</div>
<script>
const INDEX_URL = '/registry/index.json';

async function search() {
  const params = new URLSearchParams(window.location.search);
  const q = (params.get('q') || '').toLowerCase();
  const category = (params.get('category') || '').toLowerCase();
  const agent = (params.get('agent') || '').toLowerCase();
  const minQuality = parseInt(params.get('min_quality') || '0');

  const res = await fetch(INDEX_URL);
  const data = await res.json();

  let results = data.entries;

  if (q) {
    results = results.filter(e =>
      e.title.toLowerCase().includes(q) ||
      e.tags.some(t => t.toLowerCase().includes(q)) ||
      e.category.toLowerCase().includes(q)
    );
  }
  if (category) results = results.filter(e => e.category === category);
  if (agent) results = results.filter(e => e.agent_type.includes(agent) || e.agent_type.includes('any'));
  if (minQuality) results = results.filter(e => e.quality_score >= minQuality);

  const output = {
    query: { q, category, agent, min_quality: minQuality },
    count: results.length,
    results: results
  };

  // If request accepts JSON (agent request), return raw JSON
  // For browser, show formatted output
  document.getElementById('output').textContent = JSON.stringify(output, null, 2);
  document.title = `Search: ${q || 'all'} — AgentBase`;
}

search();
</script>
</body>
</html>
